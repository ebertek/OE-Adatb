-- sema letrehozasa

CREATE TABLESPACE suli_tbs
	DATAFILE 'suli_tbs.dat'
	SIZE 10M AUTOEXTEND ON;
CREATE TEMPORARY TABLESPACE suli_temp_tbs
	TEMPFILE 'suli_temp_tbs.dat'
	SIZE 5M AUTOEXTEND ON;

CREATE USER suli
	IDENTIFIED BY jelszo
	DEFAULT TABLESPACE suli_tbs
	TEMPORARY TABLESPACE suli_temp_tbs
	QUOTA 10M ON suli_tbs;
GRANT ALL PRIVILEGES TO suli;

-- korabbi tablak es szekvenciak torlese

DROP TABLE suli.Szamla PURGE;
DROP TABLE suli.Ora PURGE;
DROP TABLE suli.Tanar PURGE;
DROP TABLE suli.Diak PURGE;

DROP SEQUENCE suli.Diak_SEQ;
DROP SEQUENCE suli.Tanar_SEQ;
DROP SEQUENCE suli.Ora_SEQ;
DROP SEQUENCE suli.Szamla_SEQ;

-- pk-khoz hasznalt szekvenciak letrehozasa

CREATE SEQUENCE suli.Diak_SEQ
	MINVALUE 1
	MAXVALUE 1000
	START WITH 13
	INCREMENT BY 1
	CACHE 30;

CREATE SEQUENCE suli.Tanar_SEQ
	MINVALUE 1
	MAXVALUE 1000
	START WITH 10
	INCREMENT BY 1
	CACHE 30;

CREATE SEQUENCE suli.Ora_SEQ
	MINVALUE 1
	MAXVALUE 1000
	START WITH 20
	INCREMENT BY 1
	CACHE 30;

CREATE SEQUENCE suli.Szamla_SEQ
	MINVALUE 1
	MAXVALUE 1000
	START WITH 10
	INCREMENT BY 1
	CACHE 30;

-- 5/A: Tablak letrehozasa megszoritasokkal egyutt

CREATE TABLE suli.Diak(
	Diak_ID	NUMBER(20)	NOT NULL,
	Nev	VARCHAR2(70)	NOT NULL,
	Cim	VARCHAR2(70),
	Telefonszam	VARCHAR2(25),
	Szintfelmero	VARCHAR2(3),
	Jelenlegi_szint	VARCHAR2(3),
	CONSTRAINT Diak_Telefonszam_CHK CHECK (REGEXP_LIKE(Telefonszam,'^\+\d{6,}$')),
	CONSTRAINT Diak_Szintfelmero_CHK CHECK (REGEXP_LIKE(Szintfelmero,'^[ABC][12][\+\-]*$')),
	CONSTRAINT Diak_Jelenlegi_szint_CHK CHECK (REGEXP_LIKE(Jelenlegi_szint,'^[ABC][12][\+\-]*$')),
	CONSTRAINT Diak_PK	PRIMARY KEY(Diak_ID)
);

CREATE TABLE suli.Tanar(
	Tanar_ID	NUMBER(20)	NOT NULL,
	Nev	VARCHAR2(70)	NOT NULL,
	Cim	VARCHAR2(70)	NOT NULL,
	Telefonszam	VARCHAR2(25),
	Adoszam	VARCHAR2(14)	NOT NULL,
	CONSTRAINT Tanar_Telefonszam_CHK CHECK (REGEXP_LIKE(Telefonszam,'^\+\d{6,}$')),
	CONSTRAINT Tanar_Adoszam_UK UNIQUE (Adoszam),
	CONSTRAINT Tanar_Adoszam_CHK CHECK (REGEXP_LIKE(Adoszam,'^\d{8}-\d-\d{2}$|^\d{10}$|^[A-Z]{2}\w{8,12}$')),
	CONSTRAINT Tanar_PK	PRIMARY KEY(Tanar_ID)
);

CREATE TABLE suli.Ora(
	Ora_ID	NUMBER(20)	NOT NULL,
	Idopont	TIMESTAMP WITH TIME ZONE	NOT NULL,
	Szint	VARCHAR2(3)	NOT NULL,
	Tematika	VARCHAR2(255),
	Ar	NUMBER(6)	NOT NULL,
	Tanar_ID	NUMBER(20)	NOT NULL,
	CONSTRAINT Ora_Szint_CHK CHECK (REGEXP_LIKE(Szint,'^[ABC][12][\+\-]*$')),
	CONSTRAINT Ora_PK	PRIMARY KEY(Ora_ID),
	CONSTRAINT Tanar_FK	FOREIGN KEY(Tanar_ID) REFERENCES suli.Tanar(Tanar_ID)
);

CREATE TABLE suli.Szamla(
	Szamla_ID	NUMBER(20)	NOT NULL,
	Kiallitas_ip	TIMESTAMP WITH TIME ZONE	NOT NULL,
	Fizetes_ip	TIMESTAMP WITH TIME ZONE,
	Diak_ID	NUMBER(20)	NOT NULL,
	Ora_ID	NUMBER(20)	NOT NULL,
	CONSTRAINT Szamla_PK	PRIMARY KEY(Szamla_ID),
	CONSTRAINT Diak_FK	FOREIGN KEY(Diak_ID) REFERENCES suli.Diak(Diak_ID),
	CONSTRAINT Ora_FK	FOREIGN KEY(Ora_ID) REFERENCES suli.Ora(Ora_ID)
);

-- 5/B: Tablak feltoltese adatokkal
-- A kezdeti ertekeknel nem hasznaljuk a suli.xxx_SEQ.NEXTVAL-t, hogy az Orak tablat is biztosan jol tudjuk feltolteni

INSERT INTO suli.Diak
	VALUES(1,'Angol András','1034 Budapest, Bécsi út 104-108. 1. szoba','+36302646526','A1','B1');
INSERT INTO suli.Diak
	VALUES(2,'Brit Béla','1034 Budapest, Bécsi út 104-108. 2. szoba','+36302748235','B2+','C1');
INSERT INTO suli.Diak
	VALUES(3,'Cseh Csilla','1034 Budapest, Bécsi út 104-108. 3. szoba','+36302734274','A1','A2');
INSERT INTO suli.Diak
	VALUES(4,'Dán Dániel','1034 Budapest, Bécsi út 104-108. 4. szoba','+36303263264','A2','A2+');
INSERT INTO suli.Diak
	VALUES(5,'Észt Eszter','1034 Budapest, Bécsi út 104-108. 5. szoba','+36303798379','B1','B1');
INSERT INTO suli.Diak
	VALUES(6,'Finn Fruzsina','1034 Budapest, Bécsi út 104-108. 6. szoba','+36302646526','B2-','C1');
INSERT INTO suli.Diak
	VALUES(7,'Grúz Gábor','1034 Budapest, Bécsi út 104-108. 7. szoba','+36304789422','B1','A2');
INSERT INTO suli.Diak
	VALUES(8,'Holland Hedvig','1034 Budapest, Bécsi út 104-108. 8. szoba','+36304655263','B1+','B2');
INSERT INTO suli.Diak
	VALUES(9,'Izraeli Ibolya','1034 Budapest, Bécsi út 104-108. 9. szoba','+36304972354','A1','A2');
INSERT INTO suli.Diak
	VALUES(10,'Jamaicai János','1034 Budapest, Bécsi út 104-108. 10. szoba','+36305262422','B1-','C2');
INSERT INTO suli.Diak
	VALUES(11,'Kubai Károly','7624 Pécs, Petőfi utca 8.','+36305822452','B2','B1');
INSERT INTO suli.Diak
	VALUES(12,'Lengyel László','7636 Pécs, Kenderföld utca 11.','+36305364935','B2','B1');

INSERT INTO suli.Tanar
	VALUES(1,'Magyar Melinda','7632 Pécs, Mezőszél utca 6.','+36306249276','HU12345678');
INSERT INTO suli.Tanar
	VALUES(2,'Norvég Nándor','7632 Pécs, Maléter Pál út 40.','+36306678346','23456789-2-22');
INSERT INTO suli.Tanar
	VALUES(3,'Orosz Olga','7633 Pécs, Endresz György utca 19.','+36306767965','34567890-2-42');
INSERT INTO suli.Tanar
	VALUES(4,'Portugál Péter','7624 Pécs, Éva utca 15.','+36307678842','PT212345678');
INSERT INTO suli.Tanar
	VALUES(5,'Román Réka','7636 Pécs, Polgárszőlő utca 28.','+36307662673','RO87654321');
INSERT INTO suli.Tanar
	VALUES(6,'Svéd Sándor','7625 Pécs, István utca 38.','+36307833726','SE123456789101');
INSERT INTO suli.Tanar
	VALUES(7,'Török Tamás','7635 Pécs, Körtés köz 8.','+36308676582','8123456789');
INSERT INTO suli.Tanar
	VALUES(8,'Ukrán Ubul','1034 Budapest, Bécsi út 104-108. 11. szoba','+36308572682','45678901-2-13');
INSERT INTO suli.Tanar
	VALUES(9,'Vietnámi Viktor','1034 Budapest, Bécsi út 104-108. 12. szoba','+36308438626','56789012-2-41');

INSERT INTO suli.Ora
	VALUES(1,TIMESTAMP '2020-10-19 08:00:00 +2:00','A1','Szintfelmérő',1,1);
INSERT INTO suli.Ora
	VALUES(2,TIMESTAMP '2020-10-19 09:00:00 +2:00','A2','Kezdő angol',2000,2);
INSERT INTO suli.Ora
	VALUES(3,TIMESTAMP '2020-10-19 10:00:00 +2:00','B2','Középfokú nyelvvizsga-felkészítő',3500,3);
INSERT INTO suli.Ora
	VALUES(4,TIMESTAMP '2020-10-19 11:00:00 +2:00','C1','Haladó angol',4000,4);
INSERT INTO suli.Ora
	VALUES(5,TIMESTAMP '2020-10-19 12:00:00 +2:00','C1','Business English',4500,5);
INSERT INTO suli.Ora
	VALUES(6,TIMESTAMP '2020-10-19 13:00:00 +2:00','B2','Állásinterjú-felkészítő',3000,6);
INSERT INTO suli.Ora
	VALUES(7,TIMESTAMP '2020-10-19 14:00:00 +2:00','B2+','Nyelvtan felturbózó',3500,7);
INSERT INTO suli.Ora
	VALUES(8,TIMESTAMP '2020-10-19 15:00:00 +2:00','A2','Kötetlen csoportos beszélgetés',2000,8);
INSERT INTO suli.Ora
	VALUES(9,TIMESTAMP '2020-10-19 16:00:00 +2:00','C1','Haladó angol',4000,9);
INSERT INTO suli.Ora
	VALUES(10,TIMESTAMP '2020-10-20 08:00:00 +2:00','A1','Szintfelmérő',1,1);
INSERT INTO suli.Ora
	VALUES(11,TIMESTAMP '2020-10-20 09:00:00 +2:00','B1','Alapfokú angol',2500,2);
INSERT INTO suli.Ora
	VALUES(12,TIMESTAMP '2020-10-20 10:00:00 +2:00','C2','Business English',4500,3);
INSERT INTO suli.Ora
	VALUES(13,TIMESTAMP '2020-10-20 11:00:00 +2:00','C1','Felsőfokú nyelvvizsga-felkészítő',4500,4);
INSERT INTO suli.Ora
	VALUES(14,TIMESTAMP '2020-10-20 12:00:00 +2:00','B2','Igeidők (intenzív)',4000,5);
INSERT INTO suli.Ora
	VALUES(15,TIMESTAMP '2020-10-20 13:00:00 +2:00','A2+','Kezdő angol',2000,6);
INSERT INTO suli.Ora
	VALUES(16,TIMESTAMP '2020-10-20 14:00:00 +2:00','B1','Alapfokú angol',2500,7);
INSERT INTO suli.Ora
	VALUES(17,TIMESTAMP '2020-10-20 15:00:00 +2:00','B2','Középfokú nyelvvizsga-felkészítő',3500,8);
INSERT INTO suli.Ora
	VALUES(18,TIMESTAMP '2020-10-20 16:00:00 +2:00','B1','Alapfokú nyelvvizsga-felkészítő',3000,9);
INSERT INTO suli.Ora
	VALUES(19,TIMESTAMP '2020-10-26 08:00:00 +1:00','A1','Szintfelmérő',1,1);

INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',NULL,1,1);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',NULL,2,1);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',NULL,3,1);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',NULL,4,1);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',NULL,5,1);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',NULL,6,1);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',NULL,7,1);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',NULL,8,1);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',NULL,9,1);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',NULL,10,1);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',NULL,11,1);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',NULL,12,1);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-26 09:00:00 +1:00',1,2);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-26 09:01:00 +1:00',2,2);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-27 09:12:00 +1:00',3,3);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-26 10:04:00 +1:00',4,3);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-26 11:21:00 +1:00',5,4);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-28 09:03:00 +1:00',6,4);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-27 14:37:00 +1:00',7,5);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-29 15:43:00 +1:00',8,5);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-28 16:20:00 +1:00',9,6);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-30 10:09:00 +1:00',10,6);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-30 13:51:00 +1:00',11,7);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-29 12:44:00 +1:00',12,7);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',NULL,1,8);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-29 09:39:00 +1:00',2,8);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-27 13:26:00 +1:00',3,9);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-26 08:00:00 +1:00',TIMESTAMP '2020-10-26 16:19:00 +1:00',4,9);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',NULL,1,10);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',NULL,2,10);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',NULL,3,10);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',NULL,4,10);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',NULL,5,10);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',NULL,6,10);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',TIMESTAMP '2020-10-29 10:21:00 +1:00',12,11);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',TIMESTAMP '2020-10-27 13:29:00 +1:00',11,11);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',TIMESTAMP '2020-10-30 09:54:00 +1:00',10,12);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',NULL,9,12);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',TIMESTAMP '2020-10-28 13:13:00 +1:00',8,13);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',NULL,7,13);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',TIMESTAMP '2020-10-27 09:09:00 +1:00',6,13);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',TIMESTAMP '2020-10-27 10:10:00 +1:00',5,13);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',TIMESTAMP '2020-10-28 11:11:00 +1:00',4,14);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',TIMESTAMP '2020-10-29 12:12:00 +1:00',3,14);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',NULL,2,15);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',NULL,1,15);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',TIMESTAMP '2020-11-03 11:22:00 +1:00',12,16);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',NULL,11,16);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',TIMESTAMP '2020-10-28 14:32:00 +1:00',10,17);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',NULL,9,17);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',NULL,8,18);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-10-27 08:00:00 +1:00',TIMESTAMP '2020-11-02 10:06:00 +1:00',7,18);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-11-02 08:00:00 +1:00',NULL,7,19);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-11-02 08:00:00 +1:00',NULL,8,19);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-11-02 08:00:00 +1:00',NULL,9,19);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-11-02 08:00:00 +1:00',NULL,10,19);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-11-02 08:00:00 +1:00',NULL,11,19);
INSERT INTO suli.Szamla
	VALUES(suli.Szamla_SEQ.NEXTVAL,TIMESTAMP '2020-11-02 08:00:00 +1:00',NULL,12,19);

-- 5/C: Tablak kilistazaza
SELECT * FROM suli.Diak;
SELECT * FROM suli.Tanar;
SELECT * FROM suli.Ora;
SELECT * FROM suli.Szamla;
